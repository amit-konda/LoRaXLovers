# Customer Review RAG Pipeline

A Retrieval-Augmented Generation (RAG) pipeline for searching and summarizing customer reviews with style-based steering vectors.

## Quick Start

### 1. Installation
```bash
pip install -r requirements.txt
```

### 2. Execute Pipeline

**Option A: Dashboard (Recommended for KPIs)**
```bash
streamlit run dashboard.py
```
- Navigate to "Summarize" tab to generate summaries with steering vector KPIs
- Navigate to "Statistics" tab to view aggregated KPI tables
- First run: Downloads models (~3GB) and builds vector store (5-10 min)
- Subsequent runs: Loads from cache (<10 sec)

**Option B: Command Line**
```bash
python3 main.py --mode summarize --query "battery problems" --style formal --k 5
```

### 3. Run Acceptance Tests
```bash
python3 acceptance_tests.py
```
Reproduces KPI validation tests (happy path, edge cases, empty queries).

## Order of Execution

To reproduce main KPI tables:

1. **Build vector store** (automatic on first run):
   - `dashboard.py` → loads `Dell RAG compressed.txt` → builds `vectorstore/`

2. **Generate summaries with KPIs**:
   - `dashboard.py` → "Summarize" tab → generates summary → displays KPIs
   - Or: `main.py --mode summarize` → calculates KPIs programmatically

3. **View aggregated KPIs**:
   - `dashboard.py` → "Statistics" tab → shows average KPIs across all queries

4. **Validate KPIs**:
   - `acceptance_tests.py` → runs test suite → prints KPI results

## Code Structure

### Entry Points
- **`dashboard.py`**: Main entry point for interactive KPI visualization
- **`main.py`**: CLI entry point for programmatic access
- **`acceptance_tests.py`**: Test suite for KPI validation

### Core Modules
- **`rag_pipeline.py`**: RAG pipeline implementation
  - `ReviewRAGPipeline` class: Main pipeline orchestrator
  - `summarize_reviews()`: Generates summaries with steering vectors
  - `_get_style_steering_vector()`: Trains/caches steering vectors
- **`rag_metrics.py`**: KPI calculation
  - `RAGEvaluator`: Retrieval KPIs (precision, similarity)
  - `SteeringVectorEvaluator`: Steering vector KPIs (style adherence, content quality)
- **`data_loader.py`**: Data processing
  - `parse_reviews()`: Parses review text file
  - `prepare_reviews_for_rag()`: Prepares reviews for vectorization

## Data Mapping

| File/Folder | Technique | Consumed By |
|------------|-----------|-------------|
| `Dell RAG compressed.txt` | RAG knowledge base | `data_loader.py` → `rag_pipeline.py` |
| `vectorstore/` | FAISS vector database | `rag_pipeline.py` (search) |
| `steering_vectors_cache/` | Cached steering vectors | `rag_pipeline.py` (style control) |
| `config.py` | Model/steering configuration | `rag_pipeline.py`, `dashboard.py` |

## Output Mapping

| Output | Generated By | Location |
|--------|--------------|----------|
| **Retrieval KPIs** (Precision, Similarity) | `rag_metrics.py::RAGEvaluator.evaluate_retrieval()` | Dashboard "Search" tab, Statistics tab |
| **Style Adherence Score** | `rag_metrics.py::SteeringVectorEvaluator.calculate_style_adherence_score()` | Dashboard "Summarize" tab (after summary) |
| **Content Quality Score** | `rag_metrics.py::SteeringVectorEvaluator.calculate_content_quality_score()` | Dashboard "Summarize" tab (after summary) |
| **Aggregated KPI Tables** | `rag_metrics.py::get_summary_stats()` | Dashboard "Statistics" tab |
| **Test Results** | `acceptance_tests.py` | Console output |

## KPIs

### Retrieval KPIs
1. **Retrieval Precision**: `RAGEvaluator.calculate_retrieval_precision()` - Percentage of relevant retrieved documents
2. **Semantic Similarity**: `RAGEvaluator.calculate_semantic_similarity_score()` - Average similarity to query

### Steering Vector KPIs
3. **Style Adherence**: `SteeringVectorEvaluator.calculate_style_adherence_score()` - How well output matches intended style
4. **Content Quality**: `SteeringVectorEvaluator.calculate_content_quality_score()` - Coherence and relevance preservation

See `KPI_DOCUMENTATION.md` for detailed explanations.

## Configuration

Edit `config.py`:
- `MODEL_NAME`: Language model (default: TinyLlama)
- `STEERING_VECTOR_STRENGTH`: Style application strength (0.0-1.0)
- `USE_QUANTIZATION`: Enable 8-bit quantization for CPU

## Project Files

```
├── dashboard.py              # Main dashboard (entry point)
├── main.py                   # CLI interface
├── rag_pipeline.py           # RAG pipeline core
├── rag_metrics.py            # KPI calculations
├── data_loader.py            # Data parsing
├── acceptance_tests.py      # KPI validation tests
├── config.py                # Configuration
├── Dell RAG compressed.txt  # Input data (RAG knowledge base)
└── vectorstore/             # Generated vector database
```
